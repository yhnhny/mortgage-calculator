<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canadian Mortgage Calculator</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Tailwind CSS Custom Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: '#BF9447',
                        black: '#000000'
                    }
                }
            }
        }
    </script>
    
    <!-- Custom CSS for styling -->
    <style>
        /* Custom slider styling for webkit browsers */
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #BF9447;
            cursor: pointer;
            border: 2px solid #000000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Better touch target for mobile */
            -webkit-tap-highlight-color: transparent;
        }
        
        input[type="range"]::-webkit-slider-track {
            width: 100%;
            height: 10px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 5px;
            border: 1px solid #d1d5db;
        }
        
        /* Custom slider styling for Firefox */
        input[type="range"]::-moz-range-thumb {
            height: 24px;
            width: 24px;
            border-radius: 50%;
            background: #BF9447;
            cursor: pointer;
            border: 2px solid #000000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            /* Remove default border */
            border: none;
        }
        
        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 10px;
            cursor: pointer;
            background: #e5e7eb;
            border-radius: 5px;
            border: 1px solid #d1d5db;
        }
        
        /* Focus styles for accessibility and mobile */
        input[type="range"]:focus {
            outline: none;
        }
        
        input[type="range"]:focus::-webkit-slider-thumb {
            box-shadow: 0 0 0 3px rgba(191, 148, 71, 0.3);
        }
        
        input[type="range"]:focus::-moz-range-thumb {
            box-shadow: 0 0 0 3px rgba(191, 148, 71, 0.3);
        }
        
        /* Improve touch targets for mobile buttons */
        @media (max-width: 768px) {
            button {
                min-height: 44px; /* iOS recommended touch target size */
                min-width: 44px;
            }
            
            input[type="radio"] {
                width: 18px;
                height: 18px;
            }
            
            input[type="number"], input[type="text"] {
                min-height: 44px;
                font-size: 16px; /* Prevent zoom on iOS */
            }
            
            /* Larger slider track for easier touch interaction */
            input[type="range"]::-webkit-slider-track {
                height: 12px;
            }
            
            input[type="range"]::-moz-range-track {
                height: 12px;
            }
            
            /* Larger slider thumb for mobile */
            input[type="range"]::-webkit-slider-thumb {
                height: 28px;
                width: 28px;
            }
            
            input[type="range"]::-moz-range-thumb {
                height: 28px;
                width: 28px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Main Application Container -->
    <div id="app" class="container mx-auto px-3 md:px-4 py-6 md:py-8">
        <header class="text-center mb-6 md:mb-8">
            <h1 class="text-2xl md:text-4xl font-bold text-black mb-2">Canadian Mortgage Calculator</h1>
            <p class="text-sm md:text-base text-gray-600">Calculate your mortgage payments with Canadian regulations and CMHC insurance</p>
        </header>
        
        <!-- Main Content Area -->
        <main class="max-w-7xl mx-auto">
            <!-- Comparison Mode Toggle -->
            <div class="mb-6 md:mb-8 text-center">
                <div class="inline-flex items-center bg-white rounded-lg shadow-lg p-1 md:p-2">
                    <button 
                        @click="switchToSingleMode"
                        class="px-4 md:px-6 py-2 text-sm font-medium rounded-md transition-colors"
                        :class="!comparisonMode ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                    >
                        Single Scenario
                    </button>
                    <button 
                        disabled
                        @click="switchToComparisonMode"
                        class="px-4 md:px-6 py-2 text-sm font-medium rounded-md transition-colors"
                        :class="comparisonMode ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                    >
                        Compare Scenarios (coming soon)
                    </button>
                </div>
            </div>
            
            <!-- Single Scenario Layout: 50-50 Split -->
            <div v-if="!comparisonMode" class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8">
                <!-- Left Column: Mortgage Details Input -->
                <div class="space-y-6">
                <!-- Scenario 1 Input Controls Section -->
                <section class="bg-white rounded-lg shadow-lg p-4 md:p-6">
                    <h2 class="text-xl md:text-2xl font-semibold text-black mb-4 md:mb-6">
                        Mortgage Details
                    </h2>
                    
                    <!-- Mortgage Amount Slider -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Home Price</label>
                            <div class="text-2xl font-bold text-gold mb-4">${{ homePrice.toLocaleString() }}</div>
                            
                            <!-- Range Slider -->
                            <div class="relative">
                                <input 
                                    type="range" 
                                    v-model.number="homePrice"
                                    :min="mortgageConfig.ranges.homePrice.min"
                                    :max="mortgageConfig.ranges.homePrice.max"
                                    :step="mortgageConfig.ranges.homePrice.step"
                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                    @input="updateHomePrice"
                                />
                                
                                <!-- Range Labels -->
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>${{ mortgageConfig.ranges.homePrice.min.toLocaleString() }}</span>
                                    <span>${{ mortgageConfig.ranges.homePrice.max.toLocaleString() }}</span>
                                </div>
                            </div>
                            
                            <!-- Manual Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter exact amount:</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                        <input 
                                            type="number" 
                                            v-model.number="homePrice"
                                            :min="mortgageConfig.ranges.homePrice.min"
                                            :max="mortgageConfig.ranges.homePrice.max"
                                            :step="mortgageConfig.ranges.homePrice.step"
                                            class="w-full pl-8 pr-4 py-3 md:py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold text-base md:text-sm"
                                            :class="hasFieldErrors('homePrice') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                            placeholder="Enter home price"
                                        />
                                </div>
                                
                                <!-- Home Price Validation Messages -->
                                <div v-if="getFieldValidationErrors('homePrice').length > 0" class="mt-2">
                                    <div v-for="error in getFieldValidationErrors('homePrice')" :key="error.message" 
                                         class="flex items-start p-2 rounded-md text-sm"
                                         :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                        <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                            {{ error.message }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Down Payment</label>
                            
                            <!-- Current Down Payment Display -->
                            <div class="text-xl font-semibold mb-4" :class="isDownPaymentValid ? 'text-black' : 'text-red-600'">
                                ${{ downPayment.toLocaleString() }} ({{ downPaymentPercent.toFixed(2) }}%)
                            </div>
                            
                            <!-- Down Payment Input Controls -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4 mb-4">
                                <!-- Dollar Amount Input -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Dollar Amount</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                        <input 
                                            type="number" 
                                            v-model.number="downPayment"
                                            :min="0"
                                            :max="homePrice"
                                            :step="1000"
                                            class="w-full pl-8 pr-4 py-3 md:py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold text-base md:text-sm"
                                            :class="hasFieldErrors('downPayment') || !isDownPaymentValid ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                            placeholder="Enter amount"
                                            @input="updateDownPaymentFromDollar"
                                        />
                                    </div>
                                    
                                    <!-- Down Payment Dollar Amount Validation Messages -->
                                    <div v-if="getFieldValidationErrors('downPayment').length > 0" class="mt-2">
                                        <div v-for="error in getFieldValidationErrors('downPayment')" :key="error.message" 
                                             class="flex items-start p-2 rounded-md text-sm bg-red-50 border border-red-200">
                                            <svg class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                            </svg>
                                            <div class="text-red-700">
                                                {{ error.message }}
                                                <div v-if="error.field === 'downPayment'" class="text-xs mt-1 text-red-600">
                                                    <span v-if="downPayment < 0">Down payment cannot be negative.</span>
                                                    <span v-else-if="downPayment > homePrice">Down payment cannot exceed the home price of ${{ homePrice.toLocaleString() }}.</span>
                                                    <span v-else-if="!isDownPaymentValid">Minimum required: ${{ minimumDownPayment.toLocaleString() }}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Percentage Input -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Percentage</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            :value="downPaymentPercent.toFixed(2)"
                                            :min="0"
                                            :max="100"
                                            :step="0.1"
                                            class="w-full pl-4 pr-8 py-3 md:py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold text-base md:text-sm"
                                            :class="hasFieldErrors('downPayment') || !isDownPaymentValid ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                            placeholder="Enter %"
                                            @input="updateDownPaymentFromPercent"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Percentage Buttons -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Quick Select:</label>
                                <div class="flex flex-wrap gap-2">
                                    <button 
                                        v-for="percent in [5, 10, 15, 20, 25]" 
                                        :key="percent"
                                        @click="setDownPaymentPercent(percent)"
                                        class="px-3 py-2 md:py-1 text-sm border rounded-md transition-colors min-h-[44px] md:min-h-[auto] touch-manipulation"
                                        :class="Math.abs(downPaymentPercent - percent) < 0.1 ? 'bg-gold text-white border-gold' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                                    >
                                        {{ percent }}%
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Down Payment Validation Info -->
                            <div class="text-sm">
                                <div class="text-gray-600 mb-1">
                                    Minimum Required: ${{ minimumDownPayment.toLocaleString() }} ({{ minimumDownPaymentPercent.toFixed(2) }}%)
                                </div>
                                
                                <!-- Error Message -->
                                <div v-if="!isDownPaymentValid" class="mt-2 p-3 bg-red-50 border border-red-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-red-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div class="text-red-700 font-medium">
                                            {{ downPaymentErrorMessage }}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Success Message -->
                                <div v-else class="mt-2 p-3 bg-green-50 border border-green-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-green-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div class="text-green-700 font-medium">
                                            âœ“ Down payment meets Canadian requirements
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Interest Rate</label>
                            
                            <!-- Current Rate Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ displayInterestRate }}%</div>
                            
                            <!-- Rate Type Toggle -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Rate Type:</label>
                                <div class="flex bg-gray-100 rounded-lg p-1">
                                    <button 
                                        @click="rateType = 'fixed'"
                                        class="flex-1 px-3 md:px-4 py-3 md:py-2 text-sm font-medium rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="rateType === 'fixed' ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                                    >
                                        Fixed Rate
                                    </button>
                                    <button 
                                        @click="rateType = 'variable'"
                                        class="flex-1 px-3 md:px-4 py-3 md:py-2 text-sm font-medium rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="rateType === 'variable' ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                                    >
                                        Variable Rate
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Fixed Rate Input -->
                            <div v-if="rateType === 'fixed'" class="mb-4">
                                <label class="block text-xs text-gray-600 mb-1">Fixed Interest Rate</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="interestRate"
                                        :min="mortgageConfig.ranges.interestRate.min"
                                        :max="mortgageConfig.ranges.interestRate.max"
                                        :step="mortgageConfig.ranges.interestRate.step"
                                        class="w-full pl-4 pr-8 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        :class="hasFieldErrors('interestRate') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                        placeholder="Enter rate"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Enter the fixed interest rate for your mortgage term
                                </div>
                                
                                <!-- Interest Rate Validation Messages -->
                                <div v-if="getFieldValidationErrors('interestRate').length > 0" class="mt-2">
                                    <div v-for="error in getFieldValidationErrors('interestRate')" :key="error.message" 
                                         class="flex items-start p-2 rounded-md text-sm"
                                         :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                        <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                            {{ error.message }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Variable Rate Configuration -->
                            <div v-if="rateType === 'variable'" class="space-y-4">
                                <!-- Prime Rate Configuration -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Prime Rate</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            v-model.number="primeRate"
                                            :min="mortgageConfig.ranges.primeRate.min"
                                            :max="mortgageConfig.ranges.primeRate.max"
                                            :step="mortgageConfig.ranges.primeRate.step"
                                            class="w-full pl-4 pr-8 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            :class="hasFieldErrors('primeRate') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                            placeholder="Enter prime rate"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">
                                        Current Bank of Canada prime rate
                                    </div>
                                    
                                    <!-- Prime Rate Validation Messages -->
                                    <div v-if="getFieldValidationErrors('primeRate').length > 0" class="mt-2">
                                        <div v-for="error in getFieldValidationErrors('primeRate')" :key="error.message" 
                                             class="flex items-start p-2 rounded-md text-sm"
                                             :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                            <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                            </svg>
                                            <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                            <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                                {{ error.message }}
                                                <div v-if="error.severity === 'error' && error.field === 'primeRate'" class="text-xs mt-1 text-red-600">
                                                    <span v-if="primeRate <= 0">Prime rate must be a positive number.</span>
                                                    <span v-else-if="primeRate < mortgageConfig.ranges.primeRate.min">Try a rate of {{ mortgageConfig.ranges.primeRate.min }}% or higher.</span>
                                                    <span v-else-if="primeRate > mortgageConfig.ranges.primeRate.max">Prime rates above {{ mortgageConfig.ranges.primeRate.max }}% are extremely high.</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Variable Rate Discount -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Variable Rate Discount</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            v-model.number="variableDiscount"
                                            :min="mortgageConfig.ranges.variableDiscount.min"
                                            :max="mortgageConfig.ranges.variableDiscount.max"
                                            :step="mortgageConfig.ranges.variableDiscount.step"
                                            class="w-full pl-4 pr-8 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            :class="hasFieldErrors('variableDiscount') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                            placeholder="Enter discount"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">
                                        Discount off prime rate (e.g., Prime - 0.5%)
                                    </div>
                                    
                                    <!-- Variable Discount Validation Messages -->
                                    <div v-if="getFieldValidationErrors('variableDiscount').length > 0" class="mt-2">
                                        <div v-for="error in getFieldValidationErrors('variableDiscount')" :key="error.message" 
                                             class="flex items-start p-2 rounded-md text-sm"
                                             :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                            <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                            </svg>
                                            <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                            </svg>
                                            <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                                {{ error.message }}
                                                <div v-if="error.severity === 'error' && error.field === 'variableDiscount'" class="text-xs mt-1 text-red-600">
                                                    <span v-if="variableDiscount < mortgageConfig.ranges.variableDiscount.min">Discount must be at least {{ mortgageConfig.ranges.variableDiscount.min }}%.</span>
                                                    <span v-else-if="variableDiscount > mortgageConfig.ranges.variableDiscount.max">Discount cannot exceed {{ mortgageConfig.ranges.variableDiscount.max }}%.</span>
                                                    <span v-else-if="variableDiscount >= primeRate">Discount cannot be greater than the prime rate ({{ primeRate.toFixed(2) }}%).</span>
                                                    <span v-else-if="(primeRate - variableDiscount) <= 0">This would result in a negative interest rate.</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Variable Rate Calculation Display -->
                                <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
                                    <div class="text-sm">
                                        <div class="font-medium text-blue-900 mb-1">Variable Rate Calculation:</div>
                                        <div class="text-blue-700">
                                            {{ primeRate.toFixed(2) }}% (Prime) - {{ variableDiscount.toFixed(2) }}% (Discount) = {{ (primeRate - variableDiscount).toFixed(2) }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Rate Information -->
                            <div class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <div class="text-sm">
                                    <div class="font-medium text-gray-900 mb-1">Effective Rate Used in Calculations:</div>
                                    <div class="text-gray-700">
                                        {{ displayInterestRate }}% {{ rateType === 'variable' ? '(Variable)' : '(Fixed)' }}
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        {{ rateType === 'fixed' ? 'Fixed rate remains constant for the term period' : 'Variable rate may change with prime rate adjustments' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Amortization Period</label>
                            
                            <!-- Current Amortization Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ amortizationYears }} years</div>
                            
                            <!-- Amortization Period Button Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Period:</label>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                    <button 
                                        v-for="period in mortgageConfig.amortizationPeriods" 
                                        :key="period"
                                        @click="amortizationYears = period"
                                        class="px-3 md:px-4 py-3 md:py-2 text-sm font-medium border rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="amortizationYears === period ? 'bg-gold text-white border-gold shadow-sm' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400'"
                                    >
                                        {{ period }} years
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Custom Amortization Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter custom period:</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="amortizationYears"
                                        :min="5"
                                        :max="30"
                                        :step="1"
                                        class="w-full pl-4 pr-16 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        :class="hasFieldErrors('amortizationYears') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                        placeholder="Enter years"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">years</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Maximum 30 years for Canadian mortgages
                                </div>
                                
                                <!-- Amortization Period Validation Messages -->
                                <div v-if="getFieldValidationErrors('amortizationYears').length > 0" class="mt-2">
                                    <div v-for="error in getFieldValidationErrors('amortizationYears')" :key="error.message" 
                                         class="flex items-start p-2 rounded-md text-sm"
                                         :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                        <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                            {{ error.message }}
                                            <div v-if="error.severity === 'error' && error.field === 'amortizationYears'" class="text-xs mt-1 text-red-600">
                                                <span v-if="amortizationYears <= 0 || amortizationYears < 5">Try entering a value between 5 and 30 years.</span>
                                                <span v-else-if="amortizationYears > 30">Canadian regulations limit amortization to 30 years maximum.</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Interest Term</label>
                            
                            <!-- Current Interest Term Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ interestTerm }} {{ interestTerm === 1 ? 'year' : 'years' }}</div>
                            
                            <!-- Interest Term Button Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Term:</label>
                                <div class="grid grid-cols-3 sm:grid-cols-6 gap-2">
                                    <button 
                                        v-for="term in mortgageConfig.interestTerms" 
                                        :key="term"
                                        @click="interestTerm = term"
                                        class="px-2 md:px-3 py-3 md:py-2 text-sm font-medium border rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="interestTerm === term ? 'bg-gold text-white border-gold shadow-sm' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400'"
                                    >
                                        {{ term }} {{ term === 1 ? 'yr' : 'yrs' }}
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Custom Interest Term Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter custom term:</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="interestTerm"
                                        :min="1"
                                        :max="amortizationYears"
                                        :step="1"
                                        class="w-full pl-4 pr-16 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        :class="hasFieldErrors('interestTerm') ? 'border-red-300 bg-red-50' : 'border-gray-300'"
                                        placeholder="Enter years"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">years</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Cannot exceed amortization period ({{ amortizationYears }} years)
                                </div>
                                
                                <!-- Interest Term Validation Messages -->
                                <div v-if="getFieldValidationErrors('interestTerm').length > 0" class="mt-2">
                                    <div v-for="error in getFieldValidationErrors('interestTerm')" :key="error.message" 
                                         class="flex items-start p-2 rounded-md text-sm"
                                         :class="error.severity === 'error' ? 'bg-red-50 border border-red-200' : 'bg-yellow-50 border border-yellow-200'">
                                        <svg v-if="error.severity === 'error'" class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-red-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <svg v-else class="w-4 h-4 mt-0.5 mr-2 flex-shrink-0 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div :class="error.severity === 'error' ? 'text-red-700' : 'text-yellow-700'">
                                            {{ error.message }}
                                            <div v-if="error.severity === 'error' && error.field === 'interestTerm'" class="text-xs mt-1 text-red-600">
                                                <span v-if="interestTerm <= 0">Interest term must be at least 1 year.</span>
                                                <span v-else-if="interestTerm > amortizationYears">Try a term of {{ amortizationYears }} years or less.</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Payment Frequency</label>
                            
                            <!-- Current Payment Frequency Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ mortgageConfig.paymentFrequencies[paymentFrequency].label }}</div>
                            
                            <!-- Payment Frequency Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Frequency:</label>
                                <div class="space-y-2">
                                    <div 
                                        v-for="(frequency, key) in mortgageConfig.paymentFrequencies" 
                                        :key="key"
                                        class="flex items-center"
                                    >
                                        <input 
                                            type="radio" 
                                            :id="'frequency-' + key"
                                            :value="key"
                                            v-model="paymentFrequency"
                                            class="w-5 h-5 md:w-4 md:h-4 text-gold bg-gray-100 border-gray-300 focus:ring-gold focus:ring-2"
                                        />
                                        <label 
                                            :for="'frequency-' + key" 
                                            class="ml-3 md:ml-2 text-sm font-medium text-gray-900 cursor-pointer py-2 md:py-0"
                                        >
                                            {{ frequency.label }}
                                            <span class="text-gray-500 text-xs ml-1">({{ frequency.value }} payments/year)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Frequency Information -->
                            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
                                <div class="text-sm">
                                    <div class="font-medium text-blue-900 mb-1">Payment Information:</div>
                                    <div class="text-blue-700">
                                        <div>Frequency: {{ mortgageConfig.paymentFrequencies[paymentFrequency].label }}</div>
                                        <div>Payments per year: {{ mortgageConfig.paymentFrequencies[paymentFrequency].value }}</div>
                                        <div v-if="isCalculationValid">Payment amount: ${{ Math.ceil(actualPayment).toLocaleString() }}</div>
                                    </div>
                                    <div class="text-xs text-blue-600 mt-1">
                                        <span v-if="paymentFrequency.includes('accelerated')">
                                            Accelerated payments help pay off your mortgage faster by making extra principal payments.
                                        </span>
                                        <span v-else-if="paymentFrequency === 'biWeekly' || paymentFrequency === 'weekly'">
                                            More frequent payments can reduce total interest paid over the life of the mortgage.
                                        </span>
                                        <span v-else>
                                            Monthly payments are the most common payment frequency for Canadian mortgages.
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                </div>
                
                <!-- Right Column: Payment Summary -->
                <div class="space-y-6">
                    <!-- Payment Summary Card -->
                    <div class="bg-white rounded-lg shadow-lg p-6 sticky top-6">
                        <h2 class="text-2xl font-semibold text-black mb-6 flex items-center">
                            <svg class="w-6 h-6 text-gold mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            Payment Summary
                        </h2>
                    
                        <div v-if="!isCalculationValid" class="p-4 bg-red-50 border border-red-200 rounded-md mb-6">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-red-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <div class="text-red-700 font-medium mb-1">Unable to calculate payments</div>
                                    <div class="text-red-600 text-sm">Please correct the input errors to see payment calculations.</div>
                                </div>
                            </div>
                        </div>
                        
                        <div v-else class="space-y-6">
                            <!-- Primary Payment Display -->
                            <div class="text-center p-6 bg-gradient-to-r from-gold/10 to-gold/5 rounded-lg border border-gold/20">
                                <div class="text-sm text-gray-600 mb-2">{{ mortgageConfig.paymentFrequencies[paymentFrequency].label }} Payment</div>
                                <div class="text-4xl font-bold text-gold mb-2">${{ Math.ceil(actualPayment).toLocaleString() }}</div>
                                <div class="text-sm text-gray-500">
                                    Monthly equivalent: ${{ Math.ceil(monthlyPayment).toLocaleString() }}
                                </div>
                            </div>
                            
                            <!-- Key Financial Metrics -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Total Interest Paid</div>
                                    <div class="text-2xl font-bold text-black">${{ Math.ceil(totalInterest).toLocaleString() }}</div>
                                    <div class="text-xs text-gray-500 mt-1">Over {{ amortizationYears }} years</div>
                                </div>
                                
                                <div class="p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Effective Interest Rate</div>
                                    <div class="text-2xl font-bold text-black">{{ displayInterestRate }}%</div>
                                    <div class="text-xs text-gray-500 mt-1">{{ rateType === 'variable' ? 'Variable rate' : 'Fixed rate' }}</div>
                                </div>
                            </div>
                            
                            <!-- Total Cost Summary -->
                            <div class="border-t border-gray-200 pt-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Mortgage Principal</span>
                                    <span class="font-semibold text-black">${{ mortgageAmount.toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600">Total Interest</span>
                                    <span class="font-semibold text-black">${{ Math.ceil(totalInterest).toLocaleString() }}</span>
                                </div>
                                <div class="flex justify-between items-center text-lg font-bold border-t border-gray-200 pt-2">
                                    <span class="text-black">Total Cost</span>
                                    <span class="text-gold">${{ Math.ceil(mortgageAmount + totalInterest).toLocaleString() }}</span>
                                </div>
                            </div>
                            
                            <!-- CMHC Insurance Summary -->
                            <div class="p-4 rounded-lg" :class="cmhcInsurance === 0 ? 'bg-green-50 border border-green-200' : 'bg-orange-50 border border-orange-200'">
                                <div class="flex items-start">
                                    <svg v-if="cmhcInsurance === 0" class="w-5 h-5 text-green-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                    </svg>
                                    <svg v-else class="w-5 h-5 text-orange-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                    </svg>
                                    <div>
                                        <div class="font-medium mb-1" :class="cmhcInsurance === 0 ? 'text-green-700' : 'text-orange-700'">
                                            {{ cmhcInsurance === 0 ? 'No CMHC Insurance Required' : 'CMHC Insurance Required' }}
                                        </div>
                                        <div class="text-sm" :class="cmhcInsurance === 0 ? 'text-green-600' : 'text-orange-600'">
                                            {{ cmhcInsurance === 0 ? 
                                                `Down payment of ${downPaymentPercent.toFixed(1)}% meets 20% minimum` : 
                                                `Insurance: $${Math.ceil(cmhcInsurance).toLocaleString()} (${cmhcRate}%)` 
                                            }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Breakdown Accordion -->
                            <div class="border border-gray-200 rounded-lg">
                                <button 
                                    @click="showPaymentBreakdown = !showPaymentBreakdown"
                                    class="w-full px-4 py-3 text-left flex items-center justify-between bg-gray-50 hover:bg-gray-100 rounded-t-lg transition-colors"
                                >
                                    <span class="font-medium text-gray-900">Payment Breakdown Details</span>
                                    <svg class="w-5 h-5 text-gray-500 transition-transform" :class="showPaymentBreakdown ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                
                                <div v-show="showPaymentBreakdown" class="p-4 border-t border-gray-200">
                                    <!-- Balance Over Time -->
                                    <div class="mb-6">
                                        <h4 class="text-sm font-medium text-gray-900 mb-3">Mortgage Balance Remaining</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                                <div class="text-xs text-gray-500">After 1 year</div>
                                                <div class="text-lg font-bold text-gold">
                                                    ${{ Math.ceil(mortgageBalanceAfterPayments(mortgageConfig.paymentFrequencies[paymentFrequency].value)).toLocaleString() }}
                                                </div>
                                            </div>
                                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                                <div class="text-xs text-gray-500">After 5 years</div>
                                                <div class="text-lg font-bold text-gold">
                                                    ${{ Math.ceil(mortgageBalanceAfterPayments(5 * mortgageConfig.paymentFrequencies[paymentFrequency].value)).toLocaleString() }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- First Few Payments Table -->
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-900 mb-3">First 6 Payments</h4>
                                        <div class="overflow-x-auto">
                                            <table class="w-full text-xs">
                                                <thead>
                                                    <tr class="bg-gray-50 border-b border-gray-200">
                                                        <th class="text-left py-2 px-2 font-medium text-gray-700">#</th>
                                                        <th class="text-right py-2 px-2 font-medium text-gray-700">Payment</th>
                                                        <th class="text-right py-2 px-2 font-medium text-gray-700">Principal</th>
                                                        <th class="text-right py-2 px-2 font-medium text-gray-700">Interest</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr v-for="payment in paymentBreakdown.slice(0, 6)" :key="payment.paymentNumber" class="border-b border-gray-100">
                                                        <td class="py-2 px-2 font-medium text-gray-900">{{ payment.paymentNumber }}</td>
                                                        <td class="py-2 px-2 text-right font-semibold text-black">${{ Math.ceil(payment.totalPayment).toLocaleString() }}</td>
                                                        <td class="py-2 px-2 text-right text-green-600">${{ Math.ceil(payment.principalPayment).toLocaleString() }}</td>
                                                        <td class="py-2 px-2 text-right text-red-600">${{ Math.ceil(payment.interestPayment).toLocaleString() }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Comparison Mode Layout (unchanged) -->
            <div v-else>
                <!-- Scenario 2 Input Controls Section (only shown in comparison mode) -->
                <section v-if="comparisonMode" class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4 md:mb-8">
                    <h2 class="text-xl md:text-2xl font-semibold text-black mb-4 md:mb-6">Scenario 2: Mortgage Details</h2>
                    
                    <!-- Mortgage Amount Slider -->
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Home Price</label>
                            <div class="text-2xl font-bold text-gold mb-4">${{ scenario2.homePrice.toLocaleString() }}</div>
                            
                            <!-- Range Slider -->
                            <div class="relative">
                                <input 
                                    type="range" 
                                    v-model.number="scenario2.homePrice"
                                    :min="mortgageConfig.ranges.homePrice.min"
                                    :max="mortgageConfig.ranges.homePrice.max"
                                    :step="mortgageConfig.ranges.homePrice.step"
                                    class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider"
                                />
                                
                                <!-- Range Labels -->
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>${{ mortgageConfig.ranges.homePrice.min.toLocaleString() }}</span>
                                    <span>${{ mortgageConfig.ranges.homePrice.max.toLocaleString() }}</span>
                                </div>
                            </div>
                            
                            <!-- Manual Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter exact amount:</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                    <input 
                                        type="number" 
                                        v-model.number="scenario2.homePrice"
                                        :min="mortgageConfig.ranges.homePrice.min"
                                        :max="mortgageConfig.ranges.homePrice.max"
                                        :step="mortgageConfig.ranges.homePrice.step"
                                        class="w-full pl-8 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        placeholder="Enter home price"
                                    />
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Down Payment</label>
                            
                            <!-- Current Down Payment Display -->
                            <div class="text-xl font-semibold mb-4" :class="isDownPaymentValid2 ? 'text-black' : 'text-red-600'">
                                ${{ scenario2.downPayment.toLocaleString() }} ({{ downPaymentPercent2.toFixed(2) }}%)
                            </div>
                            
                            <!-- Down Payment Input Controls -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4 mb-4">
                                <!-- Dollar Amount Input -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Dollar Amount</label>
                                    <div class="relative">
                                        <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">$</span>
                                        <input 
                                            type="number" 
                                            v-model.number="scenario2.downPayment"
                                            :min="0"
                                            :max="scenario2.homePrice"
                                            :step="1000"
                                            class="w-full pl-8 pr-4 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            :class="isDownPaymentValid2 ? 'border-gray-300' : 'border-red-300 bg-red-50'"
                                            placeholder="Enter amount"
                                            @input="updateDownPaymentFromDollar2"
                                        />
                                    </div>
                                </div>
                                
                                <!-- Percentage Input -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Percentage</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            :value="downPaymentPercent2.toFixed(2)"
                                            :min="0"
                                            :max="100"
                                            :step="0.1"
                                            class="w-full pl-4 pr-8 py-2 border rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            :class="isDownPaymentValid2 ? 'border-gray-300' : 'border-red-300 bg-red-50'"
                                            placeholder="Enter %"
                                            @input="updateDownPaymentFromPercent2"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Percentage Buttons -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Quick Select:</label>
                                <div class="flex flex-wrap gap-2">
                                    <button 
                                        v-for="percent in [5, 10, 15, 20, 25]" 
                                        :key="percent"
                                        @click="setDownPaymentPercent2(percent)"
                                        class="px-3 py-2 md:py-1 text-sm border rounded-md transition-colors min-h-[44px] md:min-h-[auto] touch-manipulation"
                                        :class="Math.abs(downPaymentPercent2 - percent) < 0.1 ? 'bg-gold text-white border-gold' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'"
                                    >
                                        {{ percent }}%
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Down Payment Validation Info -->
                            <div class="text-sm">
                                <div class="text-gray-600 mb-1">
                                    Minimum Required: ${{ minimumDownPayment2.toLocaleString() }} ({{ minimumDownPaymentPercent2.toFixed(2) }}%)
                                </div>
                                
                                <!-- Error Message -->
                                <div v-if="!isDownPaymentValid2" class="mt-2 p-3 bg-red-50 border border-red-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-red-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div class="text-red-700 font-medium">
                                            {{ downPaymentErrorMessage2 }}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Success Message -->
                                <div v-else class="mt-2 p-3 bg-green-50 border border-green-200 rounded-md">
                                    <div class="flex items-start">
                                        <svg class="w-5 h-5 text-green-400 mt-0.5 mr-2 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        <div class="text-green-700 font-medium">
                                            âœ“ Down payment meets Canadian requirements
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Interest Rate</label>
                            
                            <!-- Current Rate Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ displayInterestRate2 }}%</div>
                            
                            <!-- Rate Type Toggle -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Rate Type:</label>
                                <div class="flex bg-gray-100 rounded-lg p-1">
                                    <button 
                                        @click="scenario2.rateType = 'fixed'"
                                        class="flex-1 px-3 md:px-4 py-3 md:py-2 text-sm font-medium rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="scenario2.rateType === 'fixed' ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                                    >
                                        Fixed Rate
                                    </button>
                                    <button 
                                        @click="scenario2.rateType = 'variable'"
                                        class="flex-1 px-3 md:px-4 py-3 md:py-2 text-sm font-medium rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="scenario2.rateType === 'variable' ? 'bg-gold text-white shadow-sm' : 'text-gray-700 hover:text-gray-900'"
                                    >
                                        Variable Rate
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Fixed Rate Input -->
                            <div v-if="scenario2.rateType === 'fixed'" class="mb-4">
                                <label class="block text-xs text-gray-600 mb-1">Fixed Interest Rate</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="scenario2.interestRate"
                                        :min="mortgageConfig.ranges.interestRate.min"
                                        :max="mortgageConfig.ranges.interestRate.max"
                                        :step="mortgageConfig.ranges.interestRate.step"
                                        class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        placeholder="Enter rate"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Enter the fixed interest rate for your mortgage term
                                </div>
                            </div>
                            
                            <!-- Variable Rate Configuration -->
                            <div v-if="scenario2.rateType === 'variable'" class="space-y-4">
                                <!-- Prime Rate Configuration -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Prime Rate</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            v-model.number="primeRate"
                                            :min="mortgageConfig.ranges.primeRate.min"
                                            :max="mortgageConfig.ranges.primeRate.max"
                                            :step="mortgageConfig.ranges.primeRate.step"
                                            class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            placeholder="Enter prime rate"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">
                                        Current Bank of Canada prime rate (shared between scenarios)
                                    </div>
                                </div>
                                
                                <!-- Variable Rate Discount -->
                                <div>
                                    <label class="block text-xs text-gray-600 mb-1">Variable Rate Discount</label>
                                    <div class="relative">
                                        <input 
                                            type="number" 
                                            v-model.number="scenario2.variableDiscount"
                                            :min="mortgageConfig.ranges.variableDiscount.min"
                                            :max="mortgageConfig.ranges.variableDiscount.max"
                                            :step="mortgageConfig.ranges.variableDiscount.step"
                                            class="w-full pl-4 pr-8 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                            placeholder="Enter discount"
                                        />
                                        <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">%</span>
                                    </div>
                                    <div class="mt-1 text-xs text-gray-500">
                                        Discount off prime rate (e.g., Prime - 0.5%)
                                    </div>
                                </div>
                                
                                <!-- Variable Rate Calculation Display -->
                                <div class="p-3 bg-blue-50 border border-blue-200 rounded-md">
                                    <div class="text-sm">
                                        <div class="font-medium text-blue-900 mb-1">Variable Rate Calculation:</div>
                                        <div class="text-blue-700">
                                            {{ primeRate.toFixed(2) }}% (Prime) - {{ scenario2.variableDiscount.toFixed(2) }}% (Discount) = {{ (primeRate - scenario2.variableDiscount).toFixed(2) }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Rate Information -->
                            <div class="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-md">
                                <div class="text-sm">
                                    <div class="font-medium text-gray-900 mb-1">Effective Rate Used in Calculations:</div>
                                    <div class="text-gray-700">
                                        {{ displayInterestRate2 }}% {{ scenario2.rateType === 'variable' ? '(Variable)' : '(Fixed)' }}
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        {{ scenario2.rateType === 'fixed' ? 'Fixed rate remains constant for the term period' : 'Variable rate may change with prime rate adjustments' }}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Amortization Period</label>
                            
                            <!-- Current Amortization Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ scenario2.amortizationYears }} years</div>
                            
                            <!-- Amortization Period Button Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Period:</label>
                                <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                                    <button 
                                        v-for="period in mortgageConfig.amortizationPeriods" 
                                        :key="period"
                                        @click="scenario2.amortizationYears = period"
                                        class="px-3 md:px-4 py-3 md:py-2 text-sm font-medium border rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="scenario2.amortizationYears === period ? 'bg-gold text-white border-gold shadow-sm' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400'"
                                    >
                                        {{ period }} years
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Custom Amortization Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter custom period:</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="scenario2.amortizationYears"
                                        :min="5"
                                        :max="30"
                                        :step="1"
                                        class="w-full pl-4 pr-16 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        placeholder="Enter years"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">years</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Maximum 30 years for Canadian mortgages
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Interest Term</label>
                            
                            <!-- Current Interest Term Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ scenario2.interestTerm }} {{ scenario2.interestTerm === 1 ? 'year' : 'years' }}</div>
                            
                            <!-- Interest Term Button Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Term:</label>
                                <div class="grid grid-cols-3 sm:grid-cols-6 gap-2">
                                    <button 
                                        v-for="term in mortgageConfig.interestTerms" 
                                        :key="term"
                                        @click="scenario2.interestTerm = term"
                                        class="px-2 md:px-3 py-3 md:py-2 text-sm font-medium border rounded-md transition-colors min-h-[44px] touch-manipulation"
                                        :class="scenario2.interestTerm === term ? 'bg-gold text-white border-gold shadow-sm' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400'"
                                    >
                                        {{ term }} {{ term === 1 ? 'yr' : 'yrs' }}
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Custom Interest Term Input -->
                            <div class="mt-4">
                                <label class="block text-xs text-gray-600 mb-1">Or enter custom term:</label>
                                <div class="relative">
                                    <input 
                                        type="number" 
                                        v-model.number="scenario2.interestTerm"
                                        :min="1"
                                        :max="scenario2.amortizationYears"
                                        :step="1"
                                        class="w-full pl-4 pr-16 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-gold focus:border-gold"
                                        placeholder="Enter years"
                                    />
                                    <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500">years</span>
                                </div>
                                <div class="mt-1 text-xs text-gray-500">
                                    Cannot exceed amortization period ({{ scenario2.amortizationYears }} years)
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-black mb-2">Payment Frequency</label>
                            
                            <!-- Current Payment Frequency Display -->
                            <div class="text-xl font-semibold text-black mb-4">{{ mortgageConfig.paymentFrequencies[scenario2.paymentFrequency].label }}</div>
                            
                            <!-- Payment Frequency Selector -->
                            <div class="mb-4">
                                <label class="block text-xs text-gray-600 mb-2">Select Frequency:</label>
                                <div class="space-y-2">
                                    <div 
                                        v-for="(frequency, key) in mortgageConfig.paymentFrequencies" 
                                        :key="key"
                                        class="flex items-center"
                                    >
                                        <input 
                                            type="radio" 
                                            :id="'frequency2-' + key"
                                            :value="key"
                                            v-model="scenario2.paymentFrequency"
                                            class="w-4 h-4 text-gold bg-gray-100 border-gray-300 focus:ring-gold focus:ring-2"
                                        />
                                        <label 
                                            :for="'frequency2-' + key" 
                                            class="ml-2 text-sm font-medium text-gray-900 cursor-pointer"
                                        >
                                            {{ frequency.label }}
                                            <span class="text-gray-500 text-xs ml-1">({{ frequency.value }} payments/year)</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Payment Frequency Information -->
                            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-md">
                                <div class="text-sm">
                                    <div class="font-medium text-blue-900 mb-1">Payment Information:</div>
                                    <div class="text-blue-700">
                                        <div>Frequency: {{ mortgageConfig.paymentFrequencies[scenario2.paymentFrequency].label }}</div>
                                        <div>Payments per year: {{ mortgageConfig.paymentFrequencies[scenario2.paymentFrequency].value }}</div>
                                        <div v-if="isCalculationValid2">Payment amount: ${{ Math.round(actualPayment2).toLocaleString() }}</div>
                                    </div>
                                    <div class="text-xs text-blue-600 mt-1">
                                        <span v-if="scenario2.paymentFrequency === 'acceleratedBiWeekly' || scenario2.paymentFrequency === 'acceleratedWeekly'">
                                            Accelerated payments help pay off your mortgage faster by making extra principal payments.
                                        </span>
                                        <span v-else-if="scenario2.paymentFrequency === 'biWeekly' || scenario2.paymentFrequency === 'weekly'">
                                            More frequent payments can reduce total interest paid over the life of the mortgage.
                                        </span>
                                        <span v-else>
                                            Monthly payments are the most common payment frequency for Canadian mortgages.
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Results Section -->
                <section class="space-y-4 md:space-y-6">
                    <!-- Comparison Results (when comparison mode is active) -->
                    <div v-if="comparisonMode" class="space-y-4 md:space-y-6">
                        <!-- Comparison Summary Header -->
                        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6">
                            <h2 class="text-xl md:text-2xl font-semibold text-black mb-4 md:mb-6 flex items-center">
                                <svg class="w-6 h-6 text-gold mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Scenario Comparison
                            </h2>
                            
                            <!-- Total Cost Difference Highlight -->
                            <div v-if="isCalculationValid && isCalculationValid2" class="p-4 md:p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 mb-4 md:mb-6">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600 mb-2">Total Cost Difference Over {{ Math.max(amortizationYears, scenario2.amortizationYears) }} Years</div>
                                    <div class="text-3xl font-bold mb-2" :class="totalCostDifference >= 0 ? 'text-red-600' : 'text-green-600'">
                                        {{ totalCostDifference >= 0 ? '+' : '' }}${{ Math.abs(Math.round(totalCostDifference)).toLocaleString() }}
                                    </div>
                                    <div class="text-sm text-gray-500">
                                        {{ totalCostDifference >= 0 ? 'Scenario 1 costs more' : 'Scenario 2 costs more' }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Comparison Metrics -->
                            <div v-if="isCalculationValid && isCalculationValid2" class="grid grid-cols-1 sm:grid-cols-3 gap-3 md:gap-4">
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Payment Difference</div>
                                    <div class="text-lg font-bold" :class="paymentDifference >= 0 ? 'text-red-600' : 'text-green-600'">
                                        {{ paymentDifference >= 0 ? '+' : '' }}${{ Math.abs(Math.round(paymentDifference)).toLocaleString() }}
                                    </div>
                                    <div class="text-xs text-gray-500">Monthly equivalent</div>
                                </div>
                                
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Interest Difference</div>
                                    <div class="text-lg font-bold" :class="interestDifference >= 0 ? 'text-red-600' : 'text-green-600'">
                                        {{ interestDifference >= 0 ? '+' : '' }}${{ Math.abs(Math.round(interestDifference)).toLocaleString() }}
                                    </div>
                                    <div class="text-xs text-gray-500">Total over life</div>
                                </div>
                                
                                <div class="text-center p-4 bg-gray-50 rounded-lg">
                                    <div class="text-sm text-gray-600 mb-1">Rate Difference</div>
                                    <div class="text-lg font-bold" :class="rateDifference >= 0 ? 'text-red-600' : 'text-green-600'">
                                        {{ rateDifference >= 0 ? '+' : '' }}{{ rateDifference.toFixed(2) }}%
                                    </div>
                                    <div class="text-xs text-gray-500">Effective rate</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Side-by-Side Payment Comparison -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                            <!-- Scenario 1 Payment Summary -->
                            <div class="bg-white rounded-lg shadow-lg p-4 md:p-6">
                                <h3 class="text-lg md:text-xl font-semibold text-black mb-4 flex items-center">
                                    <span class="w-6 h-6 bg-gold text-white rounded-full flex items-center justify-center text-sm font-bold mr-2">1</span>
                                    Scenario 1 Payment Summary
                                </h3>
                                
                                <div v-if="!isCalculationValid" class="p-4 bg-red-50 border border-red-200 rounded-md">
                                    <div class="text-red-700 text-sm text-center">Please correct input errors to see calculations</div>
                                </div>
                                
                                <div v-else class="space-y-4">
                                    <!-- Primary Payment Display -->
                                    <div class="text-center p-4 bg-gradient-to-r from-gold/10 to-gold/5 rounded-lg border border-gold/20">
                                        <div class="text-sm text-gray-600 mb-1">{{ mortgageConfig.paymentFrequencies[paymentFrequency].label }} Payment</div>
                                        <div class="text-2xl font-bold text-gold">${{ Math.round(actualPayment).toLocaleString() }}</div>
                                        <div class="text-xs text-gray-500">Monthly: ${{ Math.round(monthlyPayment).toLocaleString() }}</div>
                                    </div>
                                    
                                    <!-- Key Metrics -->
                                    <div class="space-y-3 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Mortgage Amount</span>
                                            <span class="font-semibold">${{ mortgageAmount.toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Interest Rate</span>
                                            <span class="font-semibold">{{ displayInterestRate }}% {{ rateType === 'variable' ? '(Variable)' : '(Fixed)' }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Amortization</span>
                                            <span class="font-semibold">{{ amortizationYears }} years</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Total Interest</span>
                                            <span class="font-semibold">${{ Math.round(totalInterest).toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2">
                                            <span class="text-gray-900 font-medium">Total Cost</span>
                                            <span class="font-bold text-gold">${{ Math.round(mortgageAmount + totalInterest).toLocaleString() }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Scenario 2 Payment Summary -->
                            <div class="bg-white rounded-lg shadow-lg p-4 md:p-6">
                                <h3 class="text-lg md:text-xl font-semibold text-black mb-4 flex items-center">
                                    <span class="w-6 h-6 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-2">2</span>
                                    Scenario 2 Payment Summary
                                </h3>
                                
                                <div v-if="!isCalculationValid2" class="p-4 bg-red-50 border border-red-200 rounded-md">
                                    <div class="text-red-700 text-sm text-center">Please correct input errors to see calculations</div>
                                </div>
                                
                                <div v-else class="space-y-4">
                                    <!-- Primary Payment Display -->
                                    <div class="text-center p-4 bg-gradient-to-r from-amber-50 to-yellow-50 rounded-lg border border-amber-200">
                                        <div class="text-sm text-gray-600 mb-1">{{ mortgageConfig.paymentFrequencies[scenario2.paymentFrequency].label }} Payment</div>
                                        <div class="text-2xl font-bold text-amber-600">${{ Math.round(actualPayment2).toLocaleString() }}</div>
                                        <div class="text-xs text-gray-500">Monthly: ${{ Math.round(monthlyPayment2).toLocaleString() }}</div>
                                    </div>
                                    
                                    <!-- Key Metrics -->
                                    <div class="space-y-3 text-sm">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Mortgage Amount</span>
                                            <span class="font-semibold">${{ mortgageAmount2.toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Interest Rate</span>
                                            <span class="font-semibold">{{ displayInterestRate2 }}% {{ scenario2.rateType === 'variable' ? '(Variable)' : '(Fixed)' }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Amortization</span>
                                            <span class="font-semibold">{{ scenario2.amortizationYears }} years</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Total Interest</span>
                                            <span class="font-semibold">${{ Math.round(totalInterest2).toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2">
                                            <span class="text-gray-900 font-medium">Total Cost</span>
                                            <span class="font-bold text-amber-600">${{ Math.round(mortgageAmount2 + totalInterest2).toLocaleString() }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Side-by-Side CMHC Insurance Comparison -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                            <!-- Scenario 1 CMHC Insurance -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-black mb-4 flex items-center">
                                    <span class="w-6 h-6 bg-gold text-white rounded-full flex items-center justify-center text-sm font-bold mr-2">1</span>
                                    CMHC Insurance
                                </h3>
                                
                                <div v-if="!isCalculationValid" class="p-4 bg-gray-50 border border-gray-200 rounded-md">
                                    <div class="text-gray-600 text-center text-sm">Complete mortgage details to see insurance information</div>
                                </div>
                                
                                <div v-else-if="cmhcInsurance === 0" class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="text-center">
                                        <div class="text-green-700 font-medium mb-1">No Insurance Required</div>
                                        <div class="text-green-600 text-sm">{{ downPaymentPercent.toFixed(1) }}% down payment</div>
                                    </div>
                                </div>
                                
                                <div v-else class="space-y-3">
                                    <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg text-center">
                                        <div class="text-orange-700 font-medium mb-1">Insurance Required</div>
                                        <div class="text-2xl font-bold text-red-600">${{ Math.round(cmhcInsurance).toLocaleString() }}</div>
                                        <div class="text-sm text-gray-500">{{ cmhcRate }}% premium</div>
                                    </div>
                                    
                                    <div class="text-sm space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Base Mortgage</span>
                                            <span class="font-semibold">${{ baseMortgageAmount.toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Insurance Premium</span>
                                            <span class="font-semibold text-red-600">+${{ Math.round(cmhcInsurance).toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2">
                                            <span class="text-gray-900 font-medium">Total Mortgage</span>
                                            <span class="font-bold">${{ mortgageAmount.toLocaleString() }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Scenario 2 CMHC Insurance -->
                            <div class="bg-white rounded-lg shadow-lg p-6">
                                <h3 class="text-xl font-semibold text-black mb-4 flex items-center">
                                    <span class="w-6 h-6 bg-amber-500 text-white rounded-full flex items-center justify-center text-sm font-bold mr-2">2</span>
                                    CMHC Insurance
                                </h3>
                                
                                <div v-if="!isCalculationValid2" class="p-4 bg-gray-50 border border-gray-200 rounded-md">
                                    <div class="text-gray-600 text-center text-sm">Complete mortgage details to see insurance information</div>
                                </div>
                                
                                <div v-else-if="cmhcInsurance2 === 0" class="p-4 bg-green-50 border border-green-200 rounded-lg">
                                    <div class="text-center">
                                        <div class="text-green-700 font-medium mb-1">No Insurance Required</div>
                                        <div class="text-green-600 text-sm">{{ downPaymentPercent2.toFixed(1) }}% down payment</div>
                                    </div>
                                </div>
                                
                                <div v-else class="space-y-3">
                                    <div class="p-4 bg-orange-50 border border-orange-200 rounded-lg text-center">
                                        <div class="text-orange-700 font-medium mb-1">Insurance Required</div>
                                        <div class="text-2xl font-bold text-red-600">${{ Math.round(cmhcInsurance2).toLocaleString() }}</div>
                                        <div class="text-sm text-gray-500">{{ cmhcRate2 }}% premium</div>
                                    </div>
                                    
                                    <div class="text-sm space-y-2">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Base Mortgage</span>
                                            <span class="font-semibold">${{ baseMortgageAmount2.toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Insurance Premium</span>
                                            <span class="font-semibold text-red-600">+${{ Math.round(cmhcInsurance2).toLocaleString() }}</span>
                                        </div>
                                        <div class="flex justify-between border-t pt-2">
                                            <span class="text-gray-900 font-medium">Total Mortgage</span>
                                            <span class="font-bold">${{ mortgageAmount2.toLocaleString() }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                </section>
            </div>
        </main>
    </div>

    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Vue.js Application -->
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Configuration Object with CMHC rates and payment frequencies
                    mortgageConfig: {
                        // CMHC Insurance Rates (based on down payment percentage)
                        cmhcRates: {
                            '5-9.99': 4.00,    // 5% to 9.99% down payment
                            '10-14.99': 3.10,  // 10% to 14.99% down payment  
                            '15-19.99': 2.80,  // 15% to 19.99% down payment
                            '20+': 0.00        // 20%+ down payment (no insurance)
                        },
                        
                        // Payment Frequencies (payments per year)
                        paymentFrequencies: {
                            monthly: { value: 12, label: 'Monthly' },
                            semiMonthly: { value: 24, label: 'Semi-Monthly' },
                            biWeekly: { value: 26, label: 'Bi-Weekly' },
                            weekly: { value: 52, label: 'Weekly' },
                            acceleratedBiWeekly: { value: 26, label: 'Accelerated Bi-Weekly' },
                            acceleratedWeekly: { value: 52, label: 'Accelerated Weekly' }
                        },
                        
                        // Canadian Down Payment Rules
                        downPaymentRules: {
                            under500k: 0.05,      // 5% minimum
                            between500k1m: {      // 5% on first 500k, 10% on remainder
                                first500k: 0.05,
                                remainder: 0.10
                            },
                            over1m: 0.20          // 20% minimum
                        },
                        
                        // Common amortization periods (years)
                        amortizationPeriods: [15, 20, 25, 30],
                        
                        // Common interest terms (years)
                        interestTerms: [1, 2, 3, 5, 7, 10],
                        
                        // Input ranges and defaults
                        ranges: {
                            homePrice: { min: 100000, max: 2000000, step: 5000, default: 500000 },
                            downPayment: { min: 0, max: 1000000, step: 1000, default: 25000 },
                            interestRate: { min: 1.0, max: 15.0, step: 0.01, default: 4.45 },
                            variableDiscount: { min: 0.0, max: 3.0, step: 0.01, default: 0.5 },
                            primeRate: { min: 1.0, max: 15.0, step: 0.01, default: 4.45 }
                        }
                    },
                    
                    // Prime Rate Configuration
                    primeRate: 4.45,
                    
                    // User Input Properties
                    homePrice: 500000,
                    downPayment: 25000,
                    interestRate: 4.45,
                    rateType: 'fixed', // 'fixed' or 'variable'
                    variableDiscount: 0.5,
                    amortizationYears: 25,
                    interestTerm: 5,
                    paymentFrequency: 'monthly',
                    
                    // Comparison Mode Properties
                    comparisonMode: new URLSearchParams(window.location.search).get('mode') === 'comparison',
                    scenario2: {
                        homePrice: 500000,
                        downPayment: 25000,
                        interestRate: 5.25,
                        rateType: 'fixed',
                        variableDiscount: 0.5,
                        amortizationYears: 25,
                        interestTerm: 5,
                        paymentFrequency: 'monthly'
                    },
                    
                    // UI State Properties
                    showAdvancedOptions: false,
                    showPaymentBreakdown: false,
                    calculationErrors: [],
                    isCalculating: false
                }
            },
            computed: {
                /**
                 * Calculate the effective interest rate being used
                 */
                effectiveInterestRate() {
                    const rate = this.rateType === 'variable' 
                        ? (this.primeRate - this.variableDiscount) / 100
                        : this.interestRate / 100;
                    
                    return this.calculateEffectiveAnnualRate(rate);
                },

                /**
                 * Calculate the periodic interest rate
                 */
                periodicInterestRate() {
                    const paymentsPerYear = this.getPaymentFrequency(this.paymentFrequency);
                    return this.calculatePeriodicRate(this.effectiveInterestRate, paymentsPerYear);
                },

                /**
                 * Calculate the mortgage amount (home price minus down payment)
                 */
                baseMortgageAmount() {
                    return Math.max(0, this.homePrice - this.downPayment);
                },

                /**
                 * Calculate CMHC insurance premium
                 */
                cmhcInsurance() {
                    if (!this.isDownPaymentValid) return 0;
                    return this.calculateCMHCInsurance(this.homePrice, this.downPayment);
                },

                /**
                 * Calculate total mortgage amount including CMHC insurance
                 */
                mortgageAmount() {
                    if (!this.isDownPaymentValid) return 0;
                    return this.calculateTotalMortgageAmount(this.homePrice, this.downPayment);
                },

                /**
                 * Get CMHC insurance rate percentage
                 */
                cmhcRate() {
                    const downPaymentPercent = (this.downPayment / this.homePrice) * 100;
                    return this.getCMHCRate(downPaymentPercent);
                },

                /**
                 * Calculate total number of payments
                 */
                totalPayments() {
                    const paymentsPerYear = this.getPaymentFrequency(this.paymentFrequency);
                    return this.calculateTotalPayments(this.amortizationYears, paymentsPerYear);
                },

                /**
                 * Calculate monthly payment amount
                 */
                monthlyPayment() {
                    if (!this.isCalculationValid || this.mortgageAmount <= 0) return 0;
                    
                    const payment = this.calculateMortgagePayment(
                        this.mortgageAmount,
                        this.periodicInterestRate,
                        this.totalPayments
                    );
                    
                    // Convert to monthly equivalent if not monthly frequency
                    const paymentsPerYear = this.getPaymentFrequency(this.paymentFrequency);
                    if (paymentsPerYear !== 12) {
                        return (payment * paymentsPerYear) / 12;
                    }
                    
                    return payment;
                },

                /**
                 * Calculate actual payment amount for selected frequency
                 */
                actualPayment() {
                    if (!this.isCalculationValid || this.mortgageAmount <= 0) return 0;
                    
                    return this.calculateMortgagePayment(
                        this.mortgageAmount,
                        this.periodicInterestRate,
                        this.totalPayments
                    );
                },

                /**
                 * Calculate total interest paid over the life of the mortgage
                 */
                totalInterest() {
                    if (!this.isCalculationValid || this.mortgageAmount <= 0) return 0;
                    
                    const payment = this.calculateMortgagePayment(
                        this.mortgageAmount,
                        this.periodicInterestRate,
                        this.totalPayments
                    );
                    
                    const totalPaid = payment * this.totalPayments;
                    return totalPaid - this.mortgageAmount;
                },

                /**
                 * Get minimum down payment required for current home price
                 */
                minimumDownPayment() {
                    return this.calculateMinimumDownPayment(this.homePrice);
                },

                /**
                 * Get current down payment validation status
                 */
                downPaymentValidation() {
                    return this.validateDownPayment(this.homePrice, this.downPayment);
                },

                /**
                 * Check if current down payment is valid
                 */
                isDownPaymentValid() {
                    return this.downPaymentValidation.isValid;
                },

                /**
                 * Get down payment error message if invalid
                 */
                downPaymentErrorMessage() {
                    return this.downPaymentValidation.errorMessage;
                },

                /**
                 * Calculate down payment as percentage of home price
                 */
                downPaymentPercent() {
                    if (this.homePrice <= 0) return 0;
                    return (this.downPayment / this.homePrice) * 100;
                },

                /**
                 * Calculate minimum down payment as percentage of home price
                 */
                minimumDownPaymentPercent() {
                    if (this.homePrice <= 0) return 0;
                    return (this.minimumDownPayment / this.homePrice) * 100;
                },

                /**
                 * Validate all input values for calculation
                 */
                inputValidation() {
                    const errors = [];
                    
                    // Validate home price
                    if (this.homePrice <= 0) {
                        errors.push({ field: 'homePrice', message: 'Home price must be greater than zero.' });
                    } else if (this.homePrice < this.mortgageConfig.ranges.homePrice.min) {
                        errors.push({ field: 'homePrice', message: `Home price must be at least $${this.mortgageConfig.ranges.homePrice.min.toLocaleString()}.` });
                    } else if (this.homePrice > this.mortgageConfig.ranges.homePrice.max) {
                        errors.push({ field: 'homePrice', message: `Home price cannot exceed $${this.mortgageConfig.ranges.homePrice.max.toLocaleString()}.` });
                    }
                    
                    // Validate interest rate
                    const currentRate = this.rateType === 'variable' 
                        ? (this.primeRate - this.variableDiscount)
                        : this.interestRate;
                        
                    if (currentRate <= 0) {
                        errors.push({ field: 'interestRate', message: 'Interest rate must be greater than zero.' });
                    } else if (currentRate > 15) {
                        errors.push({ field: 'interestRate', message: 'Interest rate cannot exceed 15%.' });
                    }
                    
                    // Validate amortization period
                    if (this.amortizationYears <= 0) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be greater than zero.' });
                    } else if (this.amortizationYears > 30) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period cannot exceed 30 years in Canada.' });
                    }
                    
                    // Validate interest term
                    if (this.interestTerm <= 0) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be greater than zero.' });
                    } else if (this.interestTerm > this.amortizationYears) {
                        errors.push({ field: 'interestTerm', message: 'Interest term cannot exceed amortization period.' });
                    }
                    
                    // Add down payment validation
                    if (!this.isDownPaymentValid) {
                        errors.push({ field: 'downPayment', message: this.downPaymentErrorMessage });
                    }
                    
                    return {
                        isValid: errors.length === 0,
                        errors: errors
                    };
                },

                /**
                 * Check if all inputs are valid for calculation
                 */
                isCalculationValid() {
                    return this.getEnhancedInputValidation().isValid;
                },

                /**
                 * Get all validation errors
                 */
                validationErrors() {
                    return this.getEnhancedInputValidation().errors;
                },

                /**
                 * Get display rate for current rate type
                 */
                displayInterestRate() {
                    if (this.rateType === 'variable') {
                        return (this.primeRate - this.variableDiscount).toFixed(2);
                    }
                    return this.interestRate.toFixed(2);
                },

                /**
                 * Calculate mortgage balance remaining after specified number of payments
                 */
                mortgageBalanceAfterPayments() {
                    return (paymentsCompleted) => {
                        if (!this.isCalculationValid || this.mortgageAmount <= 0 || paymentsCompleted <= 0) {
                            return this.mortgageAmount;
                        }
                        
                        const payment = this.calculateMortgagePayment(
                            this.mortgageAmount,
                            this.periodicInterestRate,
                            this.totalPayments
                        );
                        
                        let balance = this.mortgageAmount;
                        
                        for (let i = 0; i < Math.min(paymentsCompleted, this.totalPayments); i++) {
                            const interestPayment = balance * this.periodicInterestRate;
                            const principalPayment = payment - interestPayment;
                            balance -= principalPayment;
                        }
                        
                        return Math.max(0, balance);
                    };
                },

                /**
                 * Calculate payment breakdown for first few payments
                 */
                paymentBreakdown() {
                    if (!this.isCalculationValid || this.mortgageAmount <= 0) {
                        return [];
                    }
                    
                    const payment = this.calculateMortgagePayment(
                        this.mortgageAmount,
                        this.periodicInterestRate,
                        this.totalPayments
                    );
                    
                    const breakdown = [];
                    let balance = this.mortgageAmount;
                    
                    // Calculate first 12 payments or first year, whichever is less
                    const paymentsToShow = Math.min(12, this.totalPayments);
                    
                    for (let i = 1; i <= paymentsToShow; i++) {
                        const interestPayment = balance * this.periodicInterestRate;
                        const principalPayment = payment - interestPayment;
                        balance -= principalPayment;
                        
                        breakdown.push({
                            paymentNumber: i,
                            totalPayment: payment,
                            principalPayment: principalPayment,
                            interestPayment: interestPayment,
                            remainingBalance: Math.max(0, balance)
                        });
                    }
                    
                    return breakdown;
                },

                // ===== SCENARIO 2 COMPUTED PROPERTIES =====

                /**
                 * Calculate the effective interest rate being used for scenario 2
                 */
                effectiveInterestRate2() {
                    const rate = this.scenario2.rateType === 'variable' 
                        ? (this.primeRate - this.scenario2.variableDiscount) / 100
                        : this.scenario2.interestRate / 100;
                    
                    return this.calculateEffectiveAnnualRate(rate);
                },

                /**
                 * Calculate the periodic interest rate for scenario 2
                 */
                periodicInterestRate2() {
                    const paymentsPerYear = this.getPaymentFrequency(this.scenario2.paymentFrequency);
                    return this.calculatePeriodicRate(this.effectiveInterestRate2, paymentsPerYear);
                },

                /**
                 * Calculate the mortgage amount (home price minus down payment) for scenario 2
                 */
                baseMortgageAmount2() {
                    return Math.max(0, this.scenario2.homePrice - this.scenario2.downPayment);
                },

                /**
                 * Calculate CMHC insurance premium for scenario 2
                 */
                cmhcInsurance2() {
                    if (!this.isDownPaymentValid2) return 0;
                    return this.calculateCMHCInsurance(this.scenario2.homePrice, this.scenario2.downPayment);
                },

                /**
                 * Calculate total mortgage amount including CMHC insurance for scenario 2
                 */
                mortgageAmount2() {
                    if (!this.isDownPaymentValid2) return 0;
                    return this.calculateTotalMortgageAmount(this.scenario2.homePrice, this.scenario2.downPayment);
                },

                /**
                 * Get CMHC insurance rate percentage for scenario 2
                 */
                cmhcRate2() {
                    const downPaymentPercent = (this.scenario2.downPayment / this.scenario2.homePrice) * 100;
                    return this.getCMHCRate(downPaymentPercent);
                },

                /**
                 * Calculate total number of payments for scenario 2
                 */
                totalPayments2() {
                    const paymentsPerYear = this.getPaymentFrequency(this.scenario2.paymentFrequency);
                    return this.calculateTotalPayments(this.scenario2.amortizationYears, paymentsPerYear);
                },

                /**
                 * Calculate monthly payment amount for scenario 2
                 */
                monthlyPayment2() {
                    if (!this.isCalculationValid2 || this.mortgageAmount2 <= 0) return 0;
                    
                    const payment = this.calculateMortgagePayment(
                        this.mortgageAmount2,
                        this.periodicInterestRate2,
                        this.totalPayments2
                    );
                    
                    // Convert to monthly equivalent if not monthly frequency
                    const paymentsPerYear = this.getPaymentFrequency(this.scenario2.paymentFrequency);
                    if (paymentsPerYear !== 12) {
                        return (payment * paymentsPerYear) / 12;
                    }
                    
                    return payment;
                },

                /**
                 * Calculate actual payment amount for selected frequency for scenario 2
                 */
                actualPayment2() {
                    if (!this.isCalculationValid2 || this.mortgageAmount2 <= 0) return 0;
                    
                    return this.calculateMortgagePayment(
                        this.mortgageAmount2,
                        this.periodicInterestRate2,
                        this.totalPayments2
                    );
                },

                /**
                 * Calculate total interest paid over the life of the mortgage for scenario 2
                 */
                totalInterest2() {
                    if (!this.isCalculationValid2 || this.mortgageAmount2 <= 0) return 0;
                    
                    const payment = this.calculateMortgagePayment(
                        this.mortgageAmount2,
                        this.periodicInterestRate2,
                        this.totalPayments2
                    );
                    
                    const totalPaid = payment * this.totalPayments2;
                    return totalPaid - this.mortgageAmount2;
                },

                /**
                 * Get minimum down payment required for current home price for scenario 2
                 */
                minimumDownPayment2() {
                    return this.calculateMinimumDownPayment(this.scenario2.homePrice);
                },

                /**
                 * Get current down payment validation status for scenario 2
                 */
                downPaymentValidation2() {
                    return this.validateDownPayment(this.scenario2.homePrice, this.scenario2.downPayment);
                },

                /**
                 * Check if current down payment is valid for scenario 2
                 */
                isDownPaymentValid2() {
                    return this.downPaymentValidation2.isValid;
                },

                /**
                 * Get down payment error message if invalid for scenario 2
                 */
                downPaymentErrorMessage2() {
                    return this.downPaymentValidation2.errorMessage;
                },

                /**
                 * Calculate down payment as percentage of home price for scenario 2
                 */
                downPaymentPercent2() {
                    if (this.scenario2.homePrice <= 0) return 0;
                    return (this.scenario2.downPayment / this.scenario2.homePrice) * 100;
                },

                /**
                 * Calculate minimum down payment as percentage of home price for scenario 2
                 */
                minimumDownPaymentPercent2() {
                    if (this.scenario2.homePrice <= 0) return 0;
                    return (this.minimumDownPayment2 / this.scenario2.homePrice) * 100;
                },

                /**
                 * Validate all input values for calculation for scenario 2
                 */
                inputValidation2() {
                    const errors = [];
                    
                    // Validate home price
                    if (this.scenario2.homePrice <= 0) {
                        errors.push({ field: 'homePrice', message: 'Home price must be greater than zero.' });
                    } else if (this.scenario2.homePrice < this.mortgageConfig.ranges.homePrice.min) {
                        errors.push({ field: 'homePrice', message: `Home price must be at least ${this.mortgageConfig.ranges.homePrice.min.toLocaleString()}.` });
                    } else if (this.scenario2.homePrice > this.mortgageConfig.ranges.homePrice.max) {
                        errors.push({ field: 'homePrice', message: `Home price cannot exceed ${this.mortgageConfig.ranges.homePrice.max.toLocaleString()}.` });
                    }
                    
                    // Validate interest rate
                    const currentRate = this.scenario2.rateType === 'variable' 
                        ? (this.primeRate - this.scenario2.variableDiscount)
                        : this.scenario2.interestRate;
                        
                    if (currentRate <= 0) {
                        errors.push({ field: 'interestRate', message: 'Interest rate must be greater than zero.' });
                    } else if (currentRate > 15) {
                        errors.push({ field: 'interestRate', message: 'Interest rate cannot exceed 15%.' });
                    }
                    
                    // Validate amortization period
                    if (this.scenario2.amortizationYears <= 0) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be greater than zero.' });
                    } else if (this.scenario2.amortizationYears > 30) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period cannot exceed 30 years in Canada.' });
                    }
                    
                    // Validate interest term
                    if (this.scenario2.interestTerm <= 0) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be greater than zero.' });
                    } else if (this.scenario2.interestTerm > this.scenario2.amortizationYears) {
                        errors.push({ field: 'interestTerm', message: 'Interest term cannot exceed amortization period.' });
                    }
                    
                    // Add down payment validation
                    if (!this.isDownPaymentValid2) {
                        errors.push({ field: 'downPayment', message: this.downPaymentErrorMessage2 });
                    }
                    
                    return {
                        isValid: errors.length === 0,
                        errors: errors
                    };
                },

                /**
                 * Check if all inputs are valid for calculation for scenario 2
                 */
                isCalculationValid2() {
                    return this.getEnhancedInputValidation2().isValid;
                },

                /**
                 * Get all validation errors for scenario 2
                 */
                validationErrors2() {
                    return this.getEnhancedInputValidation2().errors;
                },

                /**
                 * Enhanced input validation for scenario 2 with comprehensive range checking
                 * @returns {Object} Validation result with detailed error information
                 */
                getEnhancedInputValidation2() {
                    const errors = [];
                    
                    // Validate home price
                    if (this.scenario2.homePrice === null || this.scenario2.homePrice === undefined || isNaN(this.scenario2.homePrice)) {
                        errors.push({ field: 'homePrice', message: 'Home price must be a valid number.', severity: 'error' });
                    } else if (this.scenario2.homePrice <= 0) {
                        errors.push({ field: 'homePrice', message: 'Home price must be greater than zero.', severity: 'error' });
                    } else if (this.scenario2.homePrice < this.mortgageConfig.ranges.homePrice.min) {
                        errors.push({ field: 'homePrice', message: `Home price must be at least $${this.mortgageConfig.ranges.homePrice.min.toLocaleString()}.`, severity: 'error' });
                    } else if (this.scenario2.homePrice > this.mortgageConfig.ranges.homePrice.max) {
                        errors.push({ field: 'homePrice', message: `Home price cannot exceed $${this.mortgageConfig.ranges.homePrice.max.toLocaleString()}.`, severity: 'error' });
                    } else if (this.scenario2.homePrice % this.mortgageConfig.ranges.homePrice.step !== 0) {
                        errors.push({ field: 'homePrice', message: `Home price should be in increments of $${this.mortgageConfig.ranges.homePrice.step.toLocaleString()}.`, severity: 'warning' });
                    }
                    
                    // Validate down payment
                    if (this.scenario2.downPayment === null || this.scenario2.downPayment === undefined || isNaN(this.scenario2.downPayment)) {
                        errors.push({ field: 'downPayment', message: 'Down payment must be a valid number.', severity: 'error' });
                    } else if (this.scenario2.downPayment < 0) {
                        errors.push({ field: 'downPayment', message: 'Down payment cannot be negative.', severity: 'error' });
                    } else if (this.scenario2.downPayment > this.scenario2.homePrice) {
                        errors.push({ field: 'downPayment', message: 'Down payment cannot exceed home price.', severity: 'error' });
                    } else if (!this.isDownPaymentValid2) {
                        errors.push({ field: 'downPayment', message: this.downPaymentErrorMessage2, severity: 'error' });
                    }
                    
                    // Validate interest rate (fixed rate)
                    if (this.scenario2.rateType === 'fixed') {
                        if (this.scenario2.interestRate === null || this.scenario2.interestRate === undefined || isNaN(this.scenario2.interestRate)) {
                            errors.push({ field: 'interestRate', message: 'Interest rate must be a valid number.', severity: 'error' });
                        } else if (this.scenario2.interestRate <= 0) {
                            errors.push({ field: 'interestRate', message: 'Interest rate must be greater than zero.', severity: 'error' });
                        } else if (this.scenario2.interestRate < this.mortgageConfig.ranges.interestRate.min) {
                            errors.push({ field: 'interestRate', message: `Interest rate must be at least ${this.mortgageConfig.ranges.interestRate.min}%.`, severity: 'error' });
                        } else if (this.scenario2.interestRate > this.mortgageConfig.ranges.interestRate.max) {
                            errors.push({ field: 'interestRate', message: `Interest rate cannot exceed ${this.mortgageConfig.ranges.interestRate.max}%.`, severity: 'error' });
                        } else if (this.scenario2.interestRate > 10) {
                            errors.push({ field: 'interestRate', message: 'Interest rate above 10% is unusually high. Please verify this rate.', severity: 'warning' });
                        }
                    }
                    
                    // Validate prime rate (for variable rate) - shared between scenarios
                    if (this.scenario2.rateType === 'variable') {
                        if (this.primeRate === null || this.primeRate === undefined || isNaN(this.primeRate)) {
                            errors.push({ field: 'primeRate', message: 'Prime rate must be a valid number.', severity: 'error' });
                        } else if (this.primeRate <= 0) {
                            errors.push({ field: 'primeRate', message: 'Prime rate must be greater than zero.', severity: 'error' });
                        } else if (this.primeRate < this.mortgageConfig.ranges.primeRate.min) {
                            errors.push({ field: 'primeRate', message: `Prime rate must be at least ${this.mortgageConfig.ranges.primeRate.min}%.`, severity: 'error' });
                        } else if (this.primeRate > this.mortgageConfig.ranges.primeRate.max) {
                            errors.push({ field: 'primeRate', message: `Prime rate cannot exceed ${this.mortgageConfig.ranges.primeRate.max}%.`, severity: 'error' });
                        }
                        
                        // Validate variable discount
                        if (this.scenario2.variableDiscount === null || this.scenario2.variableDiscount === undefined || isNaN(this.scenario2.variableDiscount)) {
                            errors.push({ field: 'variableDiscount', message: 'Variable discount must be a valid number.', severity: 'error' });
                        } else if (this.scenario2.variableDiscount < this.mortgageConfig.ranges.variableDiscount.min) {
                            errors.push({ field: 'variableDiscount', message: `Variable discount must be at least ${this.mortgageConfig.ranges.variableDiscount.min}%.`, severity: 'error' });
                        } else if (this.scenario2.variableDiscount > this.mortgageConfig.ranges.variableDiscount.max) {
                            errors.push({ field: 'variableDiscount', message: `Variable discount cannot exceed ${this.mortgageConfig.ranges.variableDiscount.max}%.`, severity: 'error' });
                        } else if (this.scenario2.variableDiscount >= this.primeRate) {
                            errors.push({ field: 'variableDiscount', message: 'Variable discount cannot be greater than or equal to prime rate.', severity: 'error' });
                        }
                        
                        // Validate effective variable rate
                        const effectiveVariableRate = this.primeRate - this.scenario2.variableDiscount;
                        if (effectiveVariableRate <= 0) {
                            errors.push({ field: 'variableDiscount', message: 'Effective variable rate must be greater than zero.', severity: 'error' });
                        } else if (effectiveVariableRate > 15) {
                            errors.push({ field: 'variableDiscount', message: 'Effective variable rate cannot exceed 15%.', severity: 'error' });
                        }
                    }
                    
                    // Validate amortization period
                    if (this.scenario2.amortizationYears === null || this.scenario2.amortizationYears === undefined || isNaN(this.scenario2.amortizationYears)) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be a valid number.', severity: 'error' });
                    } else if (this.scenario2.amortizationYears <= 0) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be greater than zero.', severity: 'error' });
                    } else if (this.scenario2.amortizationYears < 5) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be at least 5 years.', severity: 'error' });
                    } else if (this.scenario2.amortizationYears > 30) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period cannot exceed 30 years in Canada.', severity: 'error' });
                    } else if (!Number.isInteger(this.scenario2.amortizationYears)) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be a whole number of years.', severity: 'warning' });
                    }
                    
                    // Validate interest term
                    if (this.scenario2.interestTerm === null || this.scenario2.interestTerm === undefined || isNaN(this.scenario2.interestTerm)) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be a valid number.', severity: 'error' });
                    } else if (this.scenario2.interestTerm <= 0) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be greater than zero.', severity: 'error' });
                    } else if (this.scenario2.interestTerm > this.scenario2.amortizationYears) {
                        errors.push({ field: 'interestTerm', message: 'Interest term cannot exceed amortization period.', severity: 'error' });
                    } else if (!Number.isInteger(this.scenario2.interestTerm)) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be a whole number of years.', severity: 'warning' });
                    } else if (this.scenario2.interestTerm > 10) {
                        errors.push({ field: 'interestTerm', message: 'Interest terms longer than 10 years are uncommon in Canada.', severity: 'warning' });
                    }
                    
                    // Validate payment frequency
                    if (!this.scenario2.paymentFrequency || !this.mortgageConfig.paymentFrequencies[this.scenario2.paymentFrequency]) {
                        errors.push({ field: 'paymentFrequency', message: 'Please select a valid payment frequency.', severity: 'error' });
                    }
                    
                    return {
                        isValid: errors.filter(e => e.severity === 'error').length === 0,
                        errors: errors,
                        hasWarnings: errors.filter(e => e.severity === 'warning').length > 0,
                        errorCount: errors.filter(e => e.severity === 'error').length,
                        warningCount: errors.filter(e => e.severity === 'warning').length
                    };
                },

                /**
                 * Get display rate for current rate type for scenario 2
                 */
                displayInterestRate2() {
                    if (this.scenario2.rateType === 'variable') {
                        return (this.primeRate - this.scenario2.variableDiscount).toFixed(2);
                    }
                    return this.scenario2.interestRate.toFixed(2);
                },

                // ===== COMPARISON COMPUTED PROPERTIES =====

                /**
                 * Calculate the difference in monthly payments between scenarios
                 */
                paymentDifference() {
                    if (!this.isCalculationValid || !this.isCalculationValid2) return 0;
                    return this.monthlyPayment - this.monthlyPayment2;
                },

                /**
                 * Calculate the difference in total interest between scenarios
                 */
                interestDifference() {
                    if (!this.isCalculationValid || !this.isCalculationValid2) return 0;
                    return this.totalInterest - this.totalInterest2;
                },

                /**
                 * Calculate the difference in effective interest rates between scenarios
                 */
                rateDifference() {
                    if (!this.isCalculationValid || !this.isCalculationValid2) return 0;
                    return parseFloat(this.displayInterestRate) - parseFloat(this.displayInterestRate2);
                },

                /**
                 * Calculate the total cost difference between scenarios over amortization period
                 */
                totalCostDifference() {
                    if (!this.isCalculationValid || !this.isCalculationValid2) return 0;
                    const totalCost1 = this.mortgageAmount + this.totalInterest;
                    const totalCost2 = this.mortgageAmount2 + this.totalInterest2;
                    return totalCost1 - totalCost2;
                }
            },
            methods: {
                /**
                 * Switch to single scenario mode
                 * Simple approach - just update the mode directly
                 */
                switchToSingleMode() {
                    if (this.comparisonMode !== false) {
                        console.log('Switching to single mode');
                        this.comparisonMode = false;
                        
                        // Remove comparison mode from URL if present
                        const url = new URL(window.location);
                        if (url.searchParams.has('mode')) {
                            url.searchParams.delete('mode');
                            window.history.replaceState({}, '', url.toString());
                        }
                    }
                },

                /**
                 * Switch to comparison mode
                 * Ensures proper reactivity and UI updates
                 */
                switchToComparisonMode() {
                    console.log('Switching to comparison mode - refreshing page');
                    // Add comparison mode parameter to URL and refresh
                    const url = new URL(window.location);
                    url.searchParams.set('mode', 'comparison');
                    window.location.href = url.toString();
                },

                /**
                 * Calculate effective annual rate with semi-annual compounding
                 * Formula: re = (1 + r/2)^2 - 1
                 * @param {number} nominalRate - Annual nominal interest rate (as decimal)
                 * @returns {number} Effective annual rate (as decimal)
                 */
                calculateEffectiveAnnualRate(nominalRate) {
                    return Math.pow(1 + nominalRate / 2, 2) - 1;
                },

                /**
                 * Calculate periodic rate for different payment frequencies
                 * Formula: rp = (1 + re)^(1/n) - 1
                 * @param {number} effectiveRate - Effective annual rate (as decimal)
                 * @param {number} paymentsPerYear - Number of payments per year
                 * @returns {number} Periodic rate (as decimal)
                 */
                calculatePeriodicRate(effectiveRate, paymentsPerYear) {
                    return Math.pow(1 + effectiveRate, 1 / paymentsPerYear) - 1;
                },

                /**
                 * Calculate mortgage payment using Canadian mortgage formula
                 * Formula: P = (rp Ã— A) / (1 - (1 + rp)^(-m))
                 * @param {number} mortgageAmount - Principal mortgage amount
                 * @param {number} periodicRate - Periodic interest rate (as decimal)
                 * @param {number} totalPayments - Total number of payments
                 * @returns {number} Payment amount
                 */
                calculateMortgagePayment(mortgageAmount, periodicRate, totalPayments) {
                    if (periodicRate === 0) {
                        // Handle zero interest rate case
                        return mortgageAmount / totalPayments;
                    }
                    
                    const numerator = periodicRate * mortgageAmount;
                    const denominator = 1 - Math.pow(1 + periodicRate, -totalPayments);
                    
                    return numerator / denominator;
                },

                /**
                 * Get payment frequency multiplier
                 * @param {string} frequency - Payment frequency type
                 * @returns {number} Number of payments per year
                 */
                getPaymentFrequency(frequency) {
                    const frequencyConfig = this.mortgageConfig.paymentFrequencies[frequency];
                    return frequencyConfig ? frequencyConfig.value : 12; // Default to monthly
                },

                /**
                 * Calculate total number of payments
                 * @param {number} amortizationYears - Amortization period in years
                 * @param {number} paymentsPerYear - Number of payments per year
                 * @returns {number} Total number of payments
                 */
                calculateTotalPayments(amortizationYears, paymentsPerYear) {
                    return amortizationYears * paymentsPerYear;
                },

                /**
                 * Get CMHC insurance rate based on down payment percentage
                 * @param {number} downPaymentPercent - Down payment as percentage of home price
                 * @returns {number} CMHC insurance rate (as percentage)
                 */
                getCMHCRate(downPaymentPercent) {
                    const rates = this.mortgageConfig.cmhcRates;
                    
                    if (downPaymentPercent >= 20) {
                        return rates['20+']; // No insurance required for 20%+ down payment
                    } else if (downPaymentPercent >= 15) {
                        return rates['15-19.99']; // 15% to 19.99% down payment
                    } else if (downPaymentPercent >= 10) {
                        return rates['10-14.99']; // 10% to 14.99% down payment
                    } else {
                        return rates['5-9.99']; // 5% to 9.99% down payment
                    }
                },

                /**
                 * Calculate CMHC insurance premium
                 * @param {number} homePrice - Home purchase price
                 * @param {number} downPayment - Down payment amount
                 * @returns {number} CMHC insurance premium amount
                 */
                calculateCMHCInsurance(homePrice, downPayment) {
                    const downPaymentPercent = (downPayment / homePrice) * 100;
                    
                    // No insurance required for 20%+ down payment
                    if (downPaymentPercent >= 20) {
                        return 0;
                    }
                    
                    const mortgageAmount = homePrice - downPayment;
                    const rate = this.getCMHCRate(downPaymentPercent);
                    
                    return mortgageAmount * (rate / 100);
                },

                /**
                 * Calculate total mortgage amount including CMHC insurance
                 * @param {number} homePrice - Home purchase price
                 * @param {number} downPayment - Down payment amount
                 * @returns {number} Total mortgage amount including insurance
                 */
                calculateTotalMortgageAmount(homePrice, downPayment) {
                    const baseMortgage = homePrice - downPayment;
                    const cmhcInsurance = this.calculateCMHCInsurance(homePrice, downPayment);
                    
                    return baseMortgage + cmhcInsurance;
                },

                /**
                 * Calculate minimum down payment required for a given home price
                 * Based on Canadian regulations:
                 * - Under $500,000: 5% minimum
                 * - $500,000 to $999,999: 5% on first $500k, 10% on remainder
                 * - $1,000,000+: 20% minimum
                 * @param {number} homePrice - Home purchase price
                 * @returns {number} Minimum down payment amount required
                 */
                calculateMinimumDownPayment(homePrice) {
                    const rules = this.mortgageConfig.downPaymentRules;
                    
                    if (homePrice < 500000) {
                        // Under $500k: 5% minimum
                        return homePrice * rules.under500k;
                    } else if (homePrice < 1000000) {
                        // $500k to $999,999: 5% on first $500k, 10% on remainder
                        const first500k = 500000 * rules.between500k1m.first500k; // $25,000
                        const remainder = (homePrice - 500000) * rules.between500k1m.remainder;
                        return first500k + remainder;
                    } else {
                        // $1M+: 20% minimum
                        return homePrice * rules.over1m;
                    }
                },

                /**
                 * Validate down payment against Canadian requirements
                 * @param {number} homePrice - Home purchase price
                 * @param {number} downPayment - Proposed down payment amount
                 * @returns {Object} Validation result with isValid flag and error message
                 */
                validateDownPayment(homePrice, downPayment) {
                    // Check if down payment exceeds home price
                    if (downPayment > homePrice) {
                        return {
                            isValid: false,
                            errorMessage: 'Down payment cannot exceed the home price.',
                            errorType: 'exceeds_price'
                        };
                    }

                    // Check if down payment is negative
                    if (downPayment < 0) {
                        return {
                            isValid: false,
                            errorMessage: 'Down payment must be a positive amount.',
                            errorType: 'negative_amount'
                        };
                    }

                    // Calculate minimum required down payment
                    const minimumRequired = this.calculateMinimumDownPayment(homePrice);
                    
                    // Check if down payment meets minimum requirements
                    if (downPayment < minimumRequired) {
                        const minimumPercent = ((minimumRequired / homePrice) * 100).toFixed(2);
                        const currentPercent = ((downPayment / homePrice) * 100).toFixed(2);
                        
                        let errorMessage = '';
                        if (homePrice < 500000) {
                            errorMessage = `Minimum down payment required is 5% ($${minimumRequired.toLocaleString()}) for homes under $500,000. Current down payment is ${currentPercent}%.`;
                        } else if (homePrice < 1000000) {
                            errorMessage = `Minimum down payment required is $${minimumRequired.toLocaleString()} (5% on first $500,000 + 10% on remainder) for homes between $500,000-$999,999. Current down payment is ${currentPercent}%.`;
                        } else {
                            errorMessage = `Minimum down payment required is 20% ($${minimumRequired.toLocaleString()}) for homes $1,000,000 and above. Current down payment is ${currentPercent}%.`;
                        }
                        
                        return {
                            isValid: false,
                            errorMessage: errorMessage,
                            errorType: 'insufficient_amount',
                            minimumRequired: minimumRequired,
                            currentPercent: parseFloat(currentPercent),
                            minimumPercent: parseFloat(minimumPercent)
                        };
                    }

                    // Validation passed
                    return {
                        isValid: true,
                        errorMessage: null,
                        errorType: null
                    };
                },

                /**
                 * Get down payment validation status and error message
                 * @returns {Object} Current validation status
                 */
                getDownPaymentValidation() {
                    return this.validateDownPayment(this.homePrice, this.downPayment);
                },

                /**
                 * Enhanced input validation with comprehensive range checking
                 * @returns {Object} Validation result with detailed error information
                 */
                getEnhancedInputValidation() {
                    const errors = [];
                    
                    // Validate home price
                    if (this.homePrice === null || this.homePrice === undefined || isNaN(this.homePrice)) {
                        errors.push({ field: 'homePrice', message: 'Please enter a valid home price.', severity: 'error' });
                    } else if (this.homePrice <= 0) {
                        errors.push({ field: 'homePrice', message: 'Home price must be greater than zero.', severity: 'error' });
                    } else if (this.homePrice < this.mortgageConfig.ranges.homePrice.min) {
                        errors.push({ field: 'homePrice', message: `Home price must be at least $${this.mortgageConfig.ranges.homePrice.min.toLocaleString()}.`, severity: 'error' });
                    } else if (this.homePrice > this.mortgageConfig.ranges.homePrice.max) {
                        errors.push({ field: 'homePrice', message: `Home price cannot exceed $${this.mortgageConfig.ranges.homePrice.max.toLocaleString()}.`, severity: 'error' });
                    } else if (this.homePrice % this.mortgageConfig.ranges.homePrice.step !== 0) {
                        errors.push({ field: 'homePrice', message: `Home price should be in increments of $${this.mortgageConfig.ranges.homePrice.step.toLocaleString()}.`, severity: 'warning' });
                    }
                    
                    // Validate down payment
                    if (this.downPayment === null || this.downPayment === undefined || isNaN(this.downPayment)) {
                        errors.push({ field: 'downPayment', message: 'Down payment must be a valid number.', severity: 'error' });
                    } else if (this.downPayment < 0) {
                        errors.push({ field: 'downPayment', message: 'Down payment cannot be negative.', severity: 'error' });
                    } else if (this.downPayment > this.homePrice) {
                        errors.push({ field: 'downPayment', message: 'Down payment cannot exceed home price.', severity: 'error' });
                    } else if (!this.isDownPaymentValid) {
                        errors.push({ field: 'downPayment', message: this.downPaymentErrorMessage, severity: 'error' });
                    }
                    
                    // Validate interest rate (fixed rate)
                    if (this.rateType === 'fixed') {
                        if (this.interestRate === null || this.interestRate === undefined || isNaN(this.interestRate)) {
                            errors.push({ field: 'interestRate', message: 'Interest rate must be a valid number.', severity: 'error' });
                        } else if (this.interestRate <= 0) {
                            errors.push({ field: 'interestRate', message: 'Interest rate must be greater than zero.', severity: 'error' });
                        } else if (this.interestRate < this.mortgageConfig.ranges.interestRate.min) {
                            errors.push({ field: 'interestRate', message: `Interest rate must be at least ${this.mortgageConfig.ranges.interestRate.min}%.`, severity: 'error' });
                        } else if (this.interestRate > this.mortgageConfig.ranges.interestRate.max) {
                            errors.push({ field: 'interestRate', message: `Interest rate cannot exceed ${this.mortgageConfig.ranges.interestRate.max}%.`, severity: 'error' });
                        } else if (this.interestRate > 10) {
                            errors.push({ field: 'interestRate', message: 'Interest rate above 10% is unusually high. Please verify this rate.', severity: 'warning' });
                        }
                    }
                    
                    // Validate prime rate (for variable rate)
                    if (this.rateType === 'variable') {
                        if (this.primeRate === null || this.primeRate === undefined || isNaN(this.primeRate)) {
                            errors.push({ field: 'primeRate', message: 'Prime rate must be a valid number.', severity: 'error' });
                        } else if (this.primeRate <= 0) {
                            errors.push({ field: 'primeRate', message: 'Prime rate must be greater than zero.', severity: 'error' });
                        } else if (this.primeRate < this.mortgageConfig.ranges.primeRate.min) {
                            errors.push({ field: 'primeRate', message: `Prime rate must be at least ${this.mortgageConfig.ranges.primeRate.min}%.`, severity: 'error' });
                        } else if (this.primeRate > this.mortgageConfig.ranges.primeRate.max) {
                            errors.push({ field: 'primeRate', message: `Prime rate cannot exceed ${this.mortgageConfig.ranges.primeRate.max}%.`, severity: 'error' });
                        }
                        
                        // Validate variable discount
                        if (this.variableDiscount === null || this.variableDiscount === undefined || isNaN(this.variableDiscount)) {
                            errors.push({ field: 'variableDiscount', message: 'Variable discount must be a valid number.', severity: 'error' });
                        } else if (this.variableDiscount < this.mortgageConfig.ranges.variableDiscount.min) {
                            errors.push({ field: 'variableDiscount', message: `Variable discount must be at least ${this.mortgageConfig.ranges.variableDiscount.min}%.`, severity: 'error' });
                        } else if (this.variableDiscount > this.mortgageConfig.ranges.variableDiscount.max) {
                            errors.push({ field: 'variableDiscount', message: `Variable discount cannot exceed ${this.mortgageConfig.ranges.variableDiscount.max}%.`, severity: 'error' });
                        } else if (this.variableDiscount >= this.primeRate) {
                            errors.push({ field: 'variableDiscount', message: 'Variable discount cannot be greater than or equal to prime rate.', severity: 'error' });
                        }
                        
                        // Validate effective variable rate
                        const effectiveVariableRate = this.primeRate - this.variableDiscount;
                        if (effectiveVariableRate <= 0) {
                            errors.push({ field: 'variableDiscount', message: 'Effective variable rate must be greater than zero.', severity: 'error' });
                        } else if (effectiveVariableRate > 15) {
                            errors.push({ field: 'variableDiscount', message: 'Effective variable rate cannot exceed 15%.', severity: 'error' });
                        }
                    }
                    
                    // Validate amortization period
                    if (this.amortizationYears === null || this.amortizationYears === undefined || isNaN(this.amortizationYears)) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be a valid number.', severity: 'error' });
                    } else if (this.amortizationYears <= 0) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be greater than zero.', severity: 'error' });
                    } else if (this.amortizationYears < 5) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be at least 5 years.', severity: 'error' });
                    } else if (this.amortizationYears > 30) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period cannot exceed 30 years in Canada.', severity: 'error' });
                    } else if (!Number.isInteger(this.amortizationYears)) {
                        errors.push({ field: 'amortizationYears', message: 'Amortization period must be a whole number of years.', severity: 'warning' });
                    }
                    
                    // Validate interest term
                    if (this.interestTerm === null || this.interestTerm === undefined || isNaN(this.interestTerm)) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be a valid number.', severity: 'error' });
                    } else if (this.interestTerm <= 0) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be greater than zero.', severity: 'error' });
                    } else if (this.interestTerm > this.amortizationYears) {
                        errors.push({ field: 'interestTerm', message: 'Interest term cannot exceed amortization period.', severity: 'error' });
                    } else if (!Number.isInteger(this.interestTerm)) {
                        errors.push({ field: 'interestTerm', message: 'Interest term must be a whole number of years.', severity: 'warning' });
                    } else if (this.interestTerm > 10) {
                        errors.push({ field: 'interestTerm', message: 'Interest terms longer than 10 years are uncommon in Canada.', severity: 'warning' });
                    }
                    
                    // Validate payment frequency
                    if (!this.paymentFrequency || !this.mortgageConfig.paymentFrequencies[this.paymentFrequency]) {
                        errors.push({ field: 'paymentFrequency', message: 'Please select a valid payment frequency.', severity: 'error' });
                    }
                    
                    return {
                        isValid: errors.filter(e => e.severity === 'error').length === 0,
                        errors: errors,
                        hasWarnings: errors.filter(e => e.severity === 'warning').length > 0,
                        errorCount: errors.filter(e => e.severity === 'error').length,
                        warningCount: errors.filter(e => e.severity === 'warning').length
                    };
                },

                /**
                 * Get validation errors for a specific field
                 * @param {string} fieldName - Name of the field to validate
                 * @returns {Array} Array of validation errors for the field
                 */
                getFieldValidationErrors(fieldName) {
                    const validation = this.getEnhancedInputValidation();
                    return validation.errors.filter(error => error.field === fieldName);
                },

                /**
                 * Check if a specific field has validation errors
                 * @param {string} fieldName - Name of the field to check
                 * @returns {boolean} True if field has errors
                 */
                hasFieldErrors(fieldName) {
                    return this.getFieldValidationErrors(fieldName).filter(e => e.severity === 'error').length > 0;
                },

                /**
                 * Check if a specific field has validation warnings
                 * @param {string} fieldName - Name of the field to check
                 * @returns {boolean} True if field has warnings
                 */
                hasFieldWarnings(fieldName) {
                    return this.getFieldValidationErrors(fieldName).filter(e => e.severity === 'warning').length > 0;
                },

                /**
                 * Update home price from slider input
                 * @param {Event} event - Input event from slider
                 */
                updateHomePrice(event) {
                    const newPrice = parseInt(event.target.value);
                    this.homePrice = newPrice;
                },

                /**
                 * Update down payment from dollar amount input
                 * @param {Event} event - Input event from dollar input
                 */
                updateDownPaymentFromDollar(event) {
                    const newAmount = parseFloat(event.target.value) || 0;
                    this.downPayment = Math.max(0, Math.min(newAmount, this.homePrice));
                },

                /**
                 * Update down payment from percentage input
                 * @param {Event} event - Input event from percentage input
                 */
                updateDownPaymentFromPercent(event) {
                    const newPercent = parseFloat(event.target.value) || 0;
                    const newAmount = (this.homePrice * newPercent) / 100;
                    this.downPayment = Math.max(0, Math.min(newAmount, this.homePrice));
                },

                /**
                 * Set down payment to a specific percentage
                 * @param {number} percent - Percentage to set (5, 10, 15, 20, 25)
                 */
                setDownPaymentPercent(percent) {
                    const newAmount = (this.homePrice * percent) / 100;
                    this.downPayment = Math.round(newAmount);
                },

                // ===== SCENARIO 2 METHODS =====

                /**
                 * Update down payment from dollar amount input for scenario 2
                 * @param {Event} event - Input event from dollar input
                 */
                updateDownPaymentFromDollar2(event) {
                    const newAmount = parseFloat(event.target.value) || 0;
                    this.scenario2.downPayment = Math.max(0, Math.min(newAmount, this.scenario2.homePrice));
                },

                /**
                 * Update down payment from percentage input for scenario 2
                 * @param {Event} event - Input event from percentage input
                 */
                updateDownPaymentFromPercent2(event) {
                    const newPercent = parseFloat(event.target.value) || 0;
                    const newAmount = (this.scenario2.homePrice * newPercent) / 100;
                    this.scenario2.downPayment = Math.max(0, Math.min(newAmount, this.scenario2.homePrice));
                },

                /**
                 * Set down payment to a specific percentage for scenario 2
                 * @param {number} percent - Percentage to set (5, 10, 15, 20, 25)
                 */
                setDownPaymentPercent2(percent) {
                    const newAmount = (this.scenario2.homePrice * percent) / 100;
                    this.scenario2.downPayment = Math.round(newAmount);
                }
            },
            watch: {
                // Watch for changes in comparison mode
                comparisonMode(newValue, oldValue) {
                    console.log(`Comparison mode changed: ${oldValue} -> ${newValue}`);
                },

                // Watch for changes in home price and update down payment if needed
                homePrice(newPrice, oldPrice) {
                    // If down payment percentage stays the same, update dollar amount
                    if (oldPrice > 0) {
                        const currentPercent = this.downPayment / oldPrice;
                        const newDownPayment = newPrice * currentPercent;
                        
                        // Only update if the new amount meets minimum requirements
                        const minRequired = this.calculateMinimumDownPayment(newPrice);
                        if (newDownPayment >= minRequired) {
                            this.downPayment = Math.round(newDownPayment);
                        } else {
                            // Set to minimum required if current percentage is too low
                            this.downPayment = Math.round(minRequired);
                        }
                    }
                },
                
                // Watch for changes in rate type and update effective rate
                rateType(newType) {
                    // Trigger recalculation by updating a reactive property
                    this.$nextTick(() => {
                        // Force reactivity update
                        this.isCalculating = true;
                        this.$nextTick(() => {
                            this.isCalculating = false;
                        });
                    });
                },
                
                // Watch for changes in prime rate (affects variable rates)
                primeRate(newRate) {
                    if (this.rateType === 'variable') {
                        // Trigger recalculation for variable rates
                        this.$nextTick(() => {
                            this.isCalculating = true;
                            this.$nextTick(() => {
                                this.isCalculating = false;
                            });
                        });
                    }
                },
                
                // Watch for changes in variable discount (affects variable rates)
                variableDiscount(newDiscount) {
                    if (this.rateType === 'variable') {
                        // Trigger recalculation for variable rates
                        this.$nextTick(() => {
                            this.isCalculating = true;
                            this.$nextTick(() => {
                                this.isCalculating = false;
                            });
                        });
                    }
                },
                
                // Watch for validation errors and update UI state
                validationErrors: {
                    handler(newErrors) {
                        this.calculationErrors = newErrors;
                    },
                    deep: true
                },
                
                // Watch for changes in payment frequency and trigger updates
                paymentFrequency() {
                    this.$nextTick(() => {
                        this.isCalculating = true;
                        this.$nextTick(() => {
                            this.isCalculating = false;
                        });
                    });
                },
                
                // Watch for changes in amortization years
                amortizationYears() {
                    // Ensure interest term doesn't exceed amortization period
                    if (this.interestTerm > this.amortizationYears) {
                        this.interestTerm = this.amortizationYears;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>